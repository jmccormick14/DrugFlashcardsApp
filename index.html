<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Drug Flashcards</title>

  <!-- PWA & Icons -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" href="favicon.ico">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7fa; color: #333; display: flex; flex-direction: column; height: 100vh; padding: 10px; }
    .container { max-width: 600px; margin: auto; flex: 1; display: flex; flex-direction: column; }
    .header { text-align: center; margin-bottom: 15px; }
    .progress { font-size: 1.1em; font-weight: bold; color: #2c3e50; }
    .stats { font-size: 0.9em; color: #7f8c8d; margin-top: 4px; }
    .controls { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
    button { padding: 8px 14px; font-size: 0.9em; border: none; border-radius: 6px; cursor: pointer; transition: 0.2s; }
    button:active { transform: scale(0.98); }
    .btn-shuffle { background: #3498db; color: white; }
    .btn-review { background: #e74c3c; color: white; }
    .btn-reset { background: #95a5a6; color: white; }
    .btn-all { background: #2c3e50; color: white; }
    .btn-focus { background: #9b59b6; color: white; }
    .btn-refresh { background: #f39c12; color: white; }
    .btn-work { background: #16a085; color: white; } /* NEW for work mode */

    .card-container { perspective: 1000px; flex: 1; margin-bottom: 15px; }
    .card { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s ease-in-out; cursor: pointer; border-radius: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
    .card.flipped { transform: rotateY(180deg); }
    .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; border-radius: 12px; text-align: center; }
    .card-front { background: linear-gradient(135deg, #6ab7ff, #4a90e2); color: white; }
    .card-back { background: linear-gradient(135deg, #a8e6cf, #66bb6a); color: #1a3d1f; transform: rotateY(180deg); }

    .drug-name { font-size: 0.9em; font-style: italic; margin-top: 10px; opacity: 0.9; }
    .question { font-size: 1.3em; font-weight: 600; margin-bottom: 10px; }
    .answer { font-size: 1.1em; line-height: 1.5; }
    .nav-buttons { display: flex; justify-content: space-between; gap: 10px; }
    .nav-btn { flex: 1; padding: 12px; font-size: 1em; background: #34495e; color: white; }
    .nav-btn:disabled { background: #95a5a6; cursor: not-allowed; }
    .mark-buttons { display: flex; gap: 10px; margin-top: 10px; }
    .btn-correct { background: #27ae60; color: white; }
    .btn-incorrect { background: #c0392b; color: white; }
    .footer { text-align: center; font-size: 0.8em; color: #7f8c8d; margin-top: 10px; }

    /* Focus Mode Overlay */
    #focusOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);
      display: none; justify-content: center; align-items: center; z-index: 1000;
    }
    #focusPanel {
      background: white; padding: 20px; border-radius: 12px; max-width: 90%; max-height: 80%; overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    #focusPanel h3 { margin-bottom: 15px; text-align: center; color: #2c3e50; }
    .drug-list { display: flex; flex-direction: column; gap: 8px; }
    .drug-item {
      padding: 12px; background: #ecf0f1; border-radius: 8px; cursor: pointer; transition: 0.2s;
      text-align: center; font-weight: 500;
    }
    .drug-item:hover { background: #3498db; color: white; }
    #closeFocus { margin-top: 15px; background: #95a5a6; width: 100%; }

    /* NEW: Work Mode Overlay */
    #workOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);
      display: none; justify-content: center; align-items: center; z-index: 1000;
    }
    #workPanel {
      background: white; padding: 20px; border-radius: 12px; max-width: 90%; max-height: 80%; overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    #workPanel h3 { margin-bottom: 15px; text-align: center; color: #2c3e50; }
    #drugSearch { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #bdc3c7; border-radius: 4px; }
    #drugDropdown { width: 100%; padding: 8px; border: 1px solid #bdc3c7; border-radius: 4px; }
    #closeWork { margin-top: 15px; background: #95a5a6; width: 100%; }

    /* NEW: Summary Modal */
    #summaryModal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);
      display: none; justify-content: center; align-items: center; z-index: 1100;
    }
    #summaryContent {
      background: white; padding: 20px; border-radius: 12px; max-width: 90%; max-height: 80%; overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center;
    }
    #summaryContent .answer { color: #1a3d1f; }
    #closeSummary { margin-top: 15px; background: #95a5a6; width: 100%; }

    @media (max-width: 480px) {
      .question { font-size: 1.1em; }
      .answer { font-size: 1em; }
      button { font-size: 0.8em; padding: 6px 10px; }
    }

    @keyframes fadeInOut {
      0%   { opacity: 0; transform: translateX(-50%) translateY(10px); }
      15%  { opacity: 1; transform: translateX(-50%) translateY(0); }
      85%  { opacity: 1; transform: translateX(-50%) translateY(0); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="progress" id="progress">1 of 225</div>
      <div class="stats" id="stats">Mastered: 0 / 225 (0%)</div>
    </div>

    <div class="controls">
      <button id="shuffleBtn" class="btn-shuffle">Shuffle</button>
      <button id="reviewBtn" class="btn-review">Review Missed</button>
      <button id="focusBtn" class="btn-focus">Focus Mode</button>
      <button id="resetBtn" class="btn-reset">Reset Progress</button>
      <button id="workBtn" class="btn-work">Work Mode</button> <!-- NEW -->
      <button id="allCardsBtn" class="btn-all" style="display:none;">Back to All Cards</button>
    </div>

    <div class="card-container">
      <div class="card" id="flashcard">
        <div class="card-front"><div class="question" id="question">Tap to reveal answer</div></div>
        <div class="card-back">
          <div class="answer" id="answer"></div>
          <div class="drug-name" id="drugBack"></div>
          <div class="mark-buttons">
            <button class="btn-correct" id="correctBtn">Correct</button>
            <button class="btn-incorrect" id="incorrectBtn">Incorrect</button>
          </div>
        </div>
      </div>
    </div>

    <div class="nav-buttons">
      <button id="prevBtn" class="nav-btn">Previous</button>
      <button id="nextBtn" class="nav-btn">Next</button>
    </div>

    <div class="footer"><span id="modeText">All Cards</span></div>
  </div>

  <!-- Focus Mode Overlay -->
  <div id="focusOverlay">
    <div id="focusPanel">
      <h3>Select a Drug to Focus On</h3>
      <div class="drug-list" id="drugList"></div>
      <button id="closeFocus" class="nav-btn">Close</button>
    </div>
  </div>

  <!-- NEW: Work Mode Overlay -->
  <div id="workOverlay">
    <div id="workPanel">
      <h3>Quick Drug Summary</h3>
      <input type="text" id="drugSearch" placeholder="Search drug...">
      <select id="drugDropdown" size="10"></select>
      <button id="closeWork" class="nav-btn">Close</button>
    </div>
  </div>

  <!-- NEW: Summary Modal -->
  <div id="summaryModal">
    <div id="summaryContent">
      <h3 id="summaryTitle"></h3>
      <div id="summaryAnswer" class="answer"></div>
      <button id="closeSummary" class="nav-btn">Close</button>
    </div>
  </div>

  <script>
    // Service Worker (PWA offline)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(() => console.log('SW registered'))
          .catch(() => console.log('SW registration failed'));
      });
    }

    // === CONFIG ===
    const GOOGLE_SHEET_TSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT2AU0SWUQCCt2F5ixm66b-P0hgb94EOYq7NlHM-B2ijn5gTReD4HNLIsncYPku--OIWM-TPpPWYclF/pub?gid=1025900712&single=true&output=tsv';
    const DB_NAME = 'drugFlashcardsDB';
    const DB_VERSION = 1;
    const STORE_FLASHCARDS = 'flashcards';
    const STORE_METADATA = 'metadata';
    const REFRESH_INTERVAL_MS = 86400000; // 24 hours

    let deck = [];
    let currentIndex = 0;
    let isReviewMode = false;
    let isFocusMode = false;
    let focusDrug = null;
    let missedSet = new Set();
    let masteredSet = new Set();
    let mainDeckIndex = 0;

    // DOM Elements
    const card = document.getElementById('flashcard');
    const questionEl = document.getElementById('question');
    const answerEl = document.getElementById('answer');
    const drugBackEl = document.getElementById('drugBack');
    const progressEl = document.getElementById('progress');
    const statsEl = document.getElementById('stats');
    const modeText = document.getElementById('modeText');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const reviewBtn = document.getElementById('reviewBtn');
    const focusBtn = document.getElementById('focusBtn');
    const resetBtn = document.getElementById('resetBtn');
    const allCardsBtn = document.getElementById('allCardsBtn');
    const correctBtn = document.getElementById('correctBtn');
    const incorrectBtn = document.getElementById('incorrectBtn');
    const focusOverlay = document.getElementById('focusOverlay');
    const drugList = document.getElementById('drugList');
    const closeFocus = document.getElementById('closeFocus');

    // NEW: Work Mode Elements
    const workBtn = document.getElementById('workBtn');
    const workOverlay = document.getElementById('workOverlay');
    const drugSearch = document.getElementById('drugSearch');
    const drugDropdown = document.getElementById('drugDropdown');
    const closeWork = document.getElementById('closeWork');
    const summaryModal = document.getElementById('summaryModal');
    const summaryTitle = document.getElementById('summaryTitle');
    const summaryAnswer = document.getElementById('summaryAnswer');
    const closeSummary = document.getElementById('closeSummary');

    // Add Refresh Button
    const controls = document.querySelector('.controls');
    const refreshBtn = document.createElement('button');
    refreshBtn.textContent = 'Refresh Data';
    refreshBtn.className = 'btn-refresh';
    refreshBtn.addEventListener('click', forceRefreshData);
    controls.appendChild(refreshBtn);
//Helper
    flashcards.forEach((card, index) => {
      card.id = index;
    });
    
    // === INDEXEDDB HELPERS ===
    function openDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        request.onerror = () => reject(request.error);
        request.onsuccess = () => resolve(request.result);
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          if (!db.objectStoreNames.contains(STORE_FLASHCARDS)) {
            db.createObjectStore(STORE_FLASHCARDS, { keyPath: 'id', autoIncrement: true });
          }
          if (!db.objectStoreNames.contains(STORE_METADATA)) {
            db.createObjectStore(STORE_METADATA, { keyPath: 'key' });
          }
        };
      });
    }

    async function getAllFromStore(storeName) {
      const db = await openDB();
      return new Promise((resolve) => {
        const transaction = db.transaction(storeName, 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.getAll();
        request.onsuccess = () => resolve(request.result);
        transaction.oncomplete = () => db.close();
      });
    }

    async function putToStore(storeName, data) {
      const db = await openDB();
      return new Promise((resolve) => {
        const transaction = db.transaction(storeName, 'readwrite');
        const store = transaction.objectStore(storeName);
        store.put(data);
        transaction.oncomplete = () => { db.close(); resolve(); };
      });
    }

    async function clearStore(storeName) {
      const db = await openDB();
      return new Promise((resolve) => {
        const transaction = db.transaction(storeName, 'readwrite');
        const store = transaction.objectStore(storeName);
        store.clear();
        transaction.oncomplete = () => { db.close(); resolve(); };
      });
    }

    async function getMetadata(key) {
      const metadata = await getAllFromStore(STORE_METADATA);
      return metadata.find(m => m.key === key)?.value;
    }

    async function setMetadata(key, value) {
      await putToStore(STORE_METADATA, { key, value });
    }

    // === DATA FETCHING ===
    async function fetchFromGoogleSheet() {
      try {
        const response = await fetch(GOOGLE_SHEET_TSV_URL);
        if (!response.ok) throw new Error('Fetch failed');
        const tsvText = await response.text();
        return parseTSV(tsvText);
      } catch (error) {
        console.error('Error fetching Google Sheet:', error);
        showToast('Failed to fetch new data. Using cached version.', '#c0392b');
        return null;
      }
    }

    function parseTSV(tsvText) {
      const lines = tsvText.split('\n').filter(line => line.trim());
      let version = '1.0'; // Default if not found
      let headerIndex = 0;

      // Check for metadata rows
      if (lines[0].startsWith('key\tvalue')) {
        // Extract version from second row
        const metadataLine = lines[1].split('\t').map(v => v.trim());
        if (metadataLine[0] === 'version') {
          version = metadataLine[1];
        }
        headerIndex = 2; // Headers now on line 2 (0-indexed)
      }

      const headers = lines[headerIndex].split('\t').map(h => h.trim());
      const flashcards = [];
      for (let i = headerIndex + 1; i < lines.length; i++) {
        const values = lines[i].split('\t').map(v => v.trim());
        const card = {};
        headers.forEach((header, idx) => {
          card[header] = values[idx] || '';
        });
        flashcards.push(card);
      }
      flashcards.forEach((card, index) => { card.id = index; });
      return { flashcards, version };
    }

    async function storeFlashcards(flashcards) {
      await clearStore(STORE_FLASHCARDS);
      const db = await openDB();
      const transaction = db.transaction(STORE_FLASHCARDS, 'readwrite');
      const store = transaction.objectStore(STORE_FLASHCARDS);
      flashcards.forEach(card => store.add(card));
      await new Promise(resolve => transaction.oncomplete = resolve);
      db.close();
    }

    // === REFRESH LOGIC ===
    async function loadFlashcards() {
      const lastFetch = await getMetadata('lastFetch');
      const now = Date.now();
      let flashcards = await getAllFromStore(STORE_FLASHCARDS);

      if (!flashcards.length || !lastFetch || (now - lastFetch > REFRESH_INTERVAL_MS)) {
        const freshData = await fetchFromGoogleSheet();
        if (freshData) {
          flashcards = freshData;
          await storeFlashcards(flashcards);
          await setMetadata('lastFetch', now);
          showToast('Data refreshed from Google Sheet!', '#27ae60');
        }
      }

      return flashcards;
    }

    async function forceRefreshData() {
      const freshData = await fetchFromGoogleSheet();
      if (freshData) {
        await storeFlashcards(freshData);
        await setMetadata('lastFetch', Date.now());
        deck = [...freshData];
        currentIndex = 0;
        updateCard();
        showToast('Data manually refreshed!', '#27ae60');
      }
    }

    function loadProgress() {
      const savedMissed = localStorage.getItem('flashcardMissed');
      const savedMastered = localStorage.getItem('flashcardMastered');
      if (savedMissed) missedSet = new Set(JSON.parse(savedMissed));
      if (savedMastered) masteredSet = new Set(JSON.parse(savedMastered));
    }
    function saveProgress() {
      localStorage.setItem('flashcardMissed', JSON.stringify([...missedSet]));
      localStorage.setItem('flashcardMastered', JSON.stringify([...masteredSet]));
    }

    function updateStats() {
      const total = flashcards.length;
      const mastered = masteredSet.size;
      const percent = Math.round((mastered / total) * 100);
      statsEl.textContent = `Mastered: ${mastered} / ${total} (${percent}%)`;
    }

    function updateCard() {
      const c = deck[currentIndex];
      questionEl.textContent = c.question;
      answerEl.innerHTML = c.answer;
      drugBackEl.textContent = c.drug;
      progressEl.textContent = `${currentIndex + 1} of ${deck.length}`;
      modeText.textContent = isFocusMode ? `Focus: ${focusDrug}` : (isReviewMode ? `Review Missed (${deck.length})` : 'All Cards');
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === deck.length - 1;
      card.classList.remove('flipped');
      updateStats();

      allCardsBtn.style.display = isReviewMode || isFocusMode ? 'inline-block' : 'none';
      reviewBtn.style.display = (isReviewMode || isFocusMode) ? 'none' : 'inline-block';
      focusBtn.style.display = (isReviewMode || isFocusMode) ? 'none' : 'inline-block';
    }

    function goTo(idx) {
      currentIndex = idx;
      updateCard();
    }

    prevBtn.addEventListener('click', () => {
      if (currentIndex > 0)  {
        if (card.classList.contains('flipped')) {
          card.classList.remove('flipped');
          setTimeout(() => goTo(currentIndex - 1), 600);  // Wait for flip animation (matches transition time)
        } else {
          goTo(currentIndex - 1);
        }
      }
    });
    
    nextBtn.addEventListener('click', () => {
      if (currentIndex < deck.length - 1) {
        if (card.classList.contains('flipped')) {
          card.classList.remove('flipped');
          setTimeout(() => goTo(currentIndex + 1), 600);  // Wait for flip animation (matches transition time)
        } else {
          goTo(currentIndex + 1);
        }
      }
    });
    
    card.addEventListener('click', () => card.classList.toggle('flipped'));

    // MARK CORRECT / INCORRECT
    correctBtn.addEventListener('click', () => {
      setTimeout(() => nextBtn.click(), 600);
      const cardId = deck[currentIndex].id;
      masteredSet.add(cardId);  // Mark as mastered
      missedSet.delete(cardId); // Remove from missed if present
      saveProgress();
      showToast("Marked Correct", "#27ae60");
      updateStats();  // Refresh stats immediately
          
    });

    incorrectBtn.addEventListener('click', () => {
          setTimeout(() => nextBtn.click(), 600);
          const cardId = deck[currentIndex].id;
          missedSet.add(cardId);    // Mark as missed
          masteredSet.delete(cardId); // Remove from mastered if present
          saveProgress();
          showToast("Marked Wrong", "#c0392b");
          updateStats();  // Refresh stats immediately
          
    });

    // SHUFFLE
    shuffleBtn.addEventListener('click', () => {
      deck = [...flashcards];
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      currentIndex = 0;
      isReviewMode = false;
      isFocusMode = false;
      updateCard();
    });

    // REVIEW MISSED
    reviewBtn.addEventListener('click', () => {
      if (missedSet.size === 0) {
        alert('No missed cards to review!');
        return;
      }
      mainDeckIndex = currentIndex;
      deck = [...missedSet].map(i => flashcards.find(c => c.id === i));
      currentIndex = 0;
      isReviewMode = true;
      isFocusMode = false;
      updateCard();
    });

    // FOCUS MODE
    focusBtn.addEventListener('click', () => {
      mainDeckIndex = currentIndex;
      const drugs = [...new Set(flashcards.map(c => c.drug))].sort();

      drugList.innerHTML = '';
      // Summaries Only Option
      const summariesItem = document.createElement('div');
      summariesItem.className = 'drug-item';
      summariesItem.textContent = 'Summaries Only';
      summariesItem.style.fontWeight = 'bold';
      summariesItem.style.background = '#27ae60';
      summariesItem.onclick = () => {
        focusDrug = 'Summaries';
        deck = flashcards.filter(c => !c.question.startsWith('What'));
        currentIndex = 0;
        isFocusMode = true;
        isReviewMode = false;
        focusOverlay.style.display = 'none';
        updateCard();
      };
      drugList.appendChild(summariesItem);

      // "None" Option
      const noneItem = document.createElement('div');
      noneItem.className = 'drug-item';
      noneItem.textContent = 'None (All Cards)';
      noneItem.style.fontWeight = 'bold';
      noneItem.style.background = '#95a5a6';
      noneItem.onclick = () => {
        deck = [...flashcards];
        currentIndex = mainDeckIndex;
        isFocusMode = false;
        isReviewMode = false;
        focusOverlay.style.display = 'none';
        updateCard();
      };
      drugList.appendChild(noneItem);

      // Drug List
      drugs.forEach(drug => {
        const item = document.createElement('div');
        item.className = 'drug-item';
        item.textContent = drug;
        item.onclick = () => {
          focusDrug = drug;
          deck = flashcards.filter(c => c.drug === drug);
          currentIndex = 0;
          isFocusMode = true;
          isReviewMode = false;
          focusOverlay.style.display = 'none';
          updateCard();
        };
        drugList.appendChild(item);
      });

      focusOverlay.style.display = 'flex';
    });

    closeFocus.addEventListener('click', () => {
      focusOverlay.style.display = 'none';
    });

    // BACK TO ALL CARDS
    allCardsBtn.addEventListener('click', () => {
      deck = [...flashcards];
      currentIndex = mainDeckIndex;
      isReviewMode = false;
      isFocusMode = false;
      updateCard();
    });

    // RESET
    resetBtn.addEventListener('click', () => {
      if (confirm('Reset all progress?')) {
        missedSet.clear();
        masteredSet.clear();
        saveProgress();
        deck = [...flashcards];
        currentIndex = 0;
        isReviewMode = false;
        isFocusMode = false;
        mainDeckIndex = 0;
        updateCard();
      }
    });

    // TOAST
    function showToast(message, bgColor) {
      const existing = document.getElementById('toast');
      if (existing) existing.remove();
      const toast = document.createElement('div');
      toast.id = 'toast';
      toast.textContent = message;
      toast.style.cssText = `position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:${bgColor};color:white;padding:12px 24px;border-radius:8px;font-weight:bold;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,0.2);animation:fadeInOut 2s ease-out forwards;`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }

    // NEW: Work Mode Logic
    workBtn.addEventListener('click', () => {
      const drugs = [...new Set(flashcards.map(c => c.drug))].sort();
      drugDropdown.innerHTML = '';
      drugs.forEach(drug => {
        const option = document.createElement('option');
        option.value = drug;
        option.textContent = drug;
        drugDropdown.appendChild(option);
      });
      drugSearch.value = '';
      workOverlay.style.display = 'flex';
    });

    drugSearch.addEventListener('input', () => {
      const filter = drugSearch.value.toLowerCase();
      Array.from(drugDropdown.options).forEach(option => {
        option.style.display = option.text.toLowerCase().includes(filter) ? 'block' : 'none';
      });
    });

    drugDropdown.addEventListener('change', () => {
      const selectedDrug = drugDropdown.value;
      if (selectedDrug) {
        const summaryCard = flashcards.find(c => c.question.toLowerCase().includes(selectedDrug.toLowerCase()) && !c.question.startsWith('What'));
        if (summaryCard) {
          summaryTitle.textContent = summaryCard.question;
          summaryAnswer.innerHTML = summaryCard.answer;
          workOverlay.style.display = 'none';
          summaryModal.style.display = 'flex';
        } else {
          showToast('No summary found for ' + selectedDrug, '#c0392b');
        }
      }
    });

    closeWork.addEventListener('click', () => {
      workOverlay.style.display = 'none';
    });

    closeSummary.addEventListener('click', () => {
      summaryModal.style.display = 'none';
    });

    // INIT
    let flashcards = [];
    loadProgress();
    async function init() {
      flashcards = await loadFlashcards();
      deck = [...flashcards];
      updateCard();
    }
    init();
  </script>
</body>
</html>

